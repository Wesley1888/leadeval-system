# 数据库设计

## 1. 表结构

### code (考核码表)
| 字段         | 类型      | 说明         |
| ------------ | --------- | ------------|
| code         | char(8)   | 主键/考核码      |
| department   | int       | 部门ID      |
| used         | tinyint   | 是否已使用(0/1) |

### person (人员表)
| 字段         | 类型      | 说明         |
| ------------ | --------- | ------------|
| id           | int       | 主键        |
| name         | varchar   | 姓名        |
| password     | varchar   | 管理员密码  |
| role         | varchar   | admin/normal|
| department   | int       | 部门ID      |

### department (部门表)
| 字段 | 类型    | 说明   |
| ---- | ------- | ------ |
| id   | int     | 主键   |
| name | varchar | 部门名 |

### indicator (指标表)
| 字段      | 类型    | 说明   |
| --------- | ------- | ------ |
| id        | int     | 主键   |
| name      | varchar | 指标名 |
| max_score | int     | 满分   |

### score (评分表)
| 字段         | 类型    | 说明         |
| ------------ | ------- | ------------|
| id           | int     | 主键        |
| scorer_code  | char(8) | 打分人考核码|
| target_id    | int     | 被考核人ID  |
| indicator_id | int     | 指标ID      |
| score        | int     | 分数        |
| year         | int     | 年份        |

## 2. 关系说明
- person.department → department.id
- score.scorer_code → code.code
- score.target_id → person.id
- score.indicator_id → indicator.id

## 3. 数据库迁移脚本

### 添加 used 字段到 code 表
```sql
-- 为 code 表添加 used 字段，默认为 0（未使用）
ALTER TABLE code ADD COLUMN used TINYINT DEFAULT 0 COMMENT '是否已使用(0/1)';

-- 更新现有数据，如果已有打分记录则标记为已使用
UPDATE code c 
SET c.used = 1 
WHERE EXISTS (
    SELECT 1 FROM score s 
    WHERE s.scorer_code = c.code 
    AND s.year = 2025
);
``` 