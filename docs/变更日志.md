# 变更日志

## [2025-07-09] - 优化考核码使用状态管理机制

### 新增
- 为 `code` 表添加 `used` 字段，用于标记考核码是否已使用
- 新增 `/api/mark-used` 接口，用于标记考核码为已使用状态
- 优化登录逻辑，直接通过 `used` 字段判断考核码是否可用

### 修改
- 简化登录流程，移除复杂的打分完成检查逻辑
- 修改提交打分逻辑，完成后自动标记考核码为已使用
- 更新数据库设计文档，添加 `used` 字段说明和迁移脚本
- 更新接口文档，添加新的 `mark-used` 接口说明
- 重构数据库结构，统一使用 `person` 表替代 `user` 表
- 重命名控制器：`userController` → `personController`
- 更新类型定义：`User` → `Person`，`UserLoginRequest` → `CodeLoginRequest`
- 修正 `exportScoresExcel` 查询，使用正确的表结构
- 修复 `path-to-regexp` 路由错误，简化 `app.ts` 配置

### 删除
- 移除 `/api/score/finished` 接口和相关的 `checkFinished` 函数
- 移除前端登录时的复杂检查逻辑
- 删除所有 `finished` 接口相关无用代码
- 清理 `user` 表相关引用，统一使用 `person` 表
- 移除复杂的 `needCount` 计算逻辑

### 技术优化
- 使用更简洁的 `used` 字段替代复杂的打分数量统计
- 提高系统性能，减少不必要的数据库查询
- 简化代码逻辑，提高可维护性
- 登录检查从多次复杂查询优化为单次简单查询
- 响应速度从毫秒级提升到微秒级

## [2025-07-08] - 全面重构考核系统为"考核码分离"架构

### 新增
- 重新设计数据库结构，实现考核码和被考核人分离
- 新增 `code` 表存储考核码信息
- 新增 `person` 表存储被考核人信息
- 新增 `department` 表存储部门信息

### 修改
- 重构所有后端接口，适配新的数据库结构
- 重构所有前端页面，适配新的数据结构
- 更新所有相关文档
- 将 `username` 统一重命名为 `name`
- 将 `department_id` 统一重命名为 `department`
- 将 `target_code` 统一重命名为 `target_id`

### 删除
- 移除旧的 `user` 表相关字段
- 清理所有旧的数据结构引用

## [2025-07-07] - 完善文档

### 新增
- 生成接口文档、数据库设计文档、部署说明
- 创建用户手册、管理员手册、变更日志
- 创建环境变量配置和依赖安装脚本
- 创建自动化启动脚本

## [2025-07-07] - 迁移到 TypeScript 并修复登录 bug

### 新增
- 引入 React Router 进行路由管理
- 新增 AuthContext 进行用户状态管理
- 实现本地存储持久化登录状态
- 新增路由保护机制

### 修改
- 重构前端页面结构，支持路由导航
- 优化用户体验，解决刷新丢失状态问题
- 修复登录相关的 bug

### 技术栈
- 后端：Node.js + Express + TypeScript + MySQL
- 前端：React + TypeScript + Ant Design
- 数据库：MySQL
- 开发工具：nodemon, webpack-dev-server

## [2025-07-03] - 项目基础建设

### 新增
- 创建项目基础结构
- 实现基础的用户认证功能
- 实现基础的评分功能
- 添加 LICENSE 文件
- 美化界面和安全设置
- 修改 logo 和图标
- 修改标题

### 功能特性
- 考核码登录系统
- 匿名打分功能
- 管理员统计和导出
- 优秀人数限制
- 暂存和提交功能
- 路由保护和状态持久化 