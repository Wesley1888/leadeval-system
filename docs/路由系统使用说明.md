# 路由系统使用说明

## 概述

LeadEval系统已升级为使用React Router的单页应用（SPA），解决了页面刷新后状态丢失的问题。

## 主要改进

### 1. 状态持久化
- 用户登录状态自动保存到浏览器本地存储
- 刷新页面后自动恢复登录状态
- 无需重新登录即可继续使用

### 2. 路由系统
- 使用React Router v6管理页面路由
- 支持浏览器前进/后退按钮
- 支持直接访问特定页面URL

### 3. 路由保护
- 未登录用户访问受保护页面会自动重定向到登录页
- 登录后自动跳转到原目标页面
- 管理员和普通用户权限分离

## 路由结构

| 路径 | 描述 | 访问权限 |
|------|------|----------|
| `/` | 根路径 | 自动重定向到合适页面 |
| `/login` | 用户登录页面 | 公开访问 |
| `/score` | 用户评分页面 | 需要用户登录 |
| `/admin/login` | 管理员登录页面 | 公开访问 |


## 使用流程

### 用户使用流程
1. 访问 `/login` 页面
2. 输入8位考核码登录
3. 自动跳转到 `/score` 页面进行评分
4. 刷新页面不会丢失登录状态
5. 完成评分后自动退出到登录页

### 管理员使用流程
1. 在登录页面点击"管理员登录"按钮
2. 或直接访问 `/admin/login` 页面
3. 输入管理员账号密码
4. 自动跳转到 `/admin/panel` 页面
5. 可以查看评分数据和导出Excel

## 技术特性

### 自动重定向
- 已登录用户访问登录页会自动跳转到评分页
- 已登录管理员访问管理员登录页会自动跳转到仪表板
- 未登录用户访问受保护页面会重定向到登录页

### 状态管理
- 使用React Context API管理全局认证状态
- 本地存储（localStorage）持久化用户信息
- 安全的登出机制，清除所有存储的状态

### 错误处理
- 网络错误时保持当前页面状态
- API调用失败时显示友好错误信息
- 路由错误时重定向到登录页

## 开发说明

### 添加新路由
1. 在 `src/routes/AppRoutes.tsx` 中添加新路由
2. 使用 `ProtectedRoute` 组件保护需要认证的路由
3. 在认证上下文中添加相应的状态管理

### 修改认证逻辑
1. 编辑 `src/contexts/AuthContext.tsx`
2. 更新本地存储的键名和数据结构
3. 确保登出时清除所有相关数据

### 后端配置
- 后端已配置支持SPA路由
- 所有非API请求都会返回前端index.html
- 确保前端构建文件在正确位置

## 故障排除

### 常见问题
1. **页面刷新后回到登录页**
   - 检查浏览器是否支持localStorage
   - 检查是否有清除浏览器数据的操作

2. **路由跳转失败**
   - 确认后端SPA路由配置正确
   - 检查前端路由配置

3. **状态不同步**
   - 清除浏览器缓存和本地存储
   - 重新登录

### 调试方法
1. 打开浏览器开发者工具
2. 查看Console中的错误信息
3. 检查Application > Local Storage中的状态
4. 查看Network标签页的API请求

## 兼容性

- 支持所有现代浏览器
- 需要JavaScript启用
- 建议使用Chrome、Firefox、Safari、Edge等主流浏览器 